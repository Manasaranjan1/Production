@isTest(seeAllData=true)
public class SalesforceOpportunityUpdateApi_Test {
    // public static user userObj = new User();
    
    Public static testmethod  void CreateOpportunity(){          
        Lead ld = [select id,Name,convertedOpportunityId from Lead where isConverted=true and convertedOpportunityId !=null limit 1];
        system.debug('kuccccccchhh'+ld);
        /*Opportunity objOpp = new Opportunity();
        objOpp.Stagename = 'New';
        objOpp.CloseDate= Date.today();
        objOpp.Name = 'Test';
        insert objOpp;*/
        String objOppId = ld.convertedOpportunityId ;
        Test.setMock(HttpCalloutMock.class, new JavaAPICallOut_Mock());       
        String requestBodyString = '{"isPPPLoanForgiven":"Yes","isOutstandingLiens":"No", "isBankruptsyFiled":"Yes","pppAmountRcvd":12345,"eidlAmountRcvd":1234,"ownerEmailAddress":"abc@yopmail.com","business_county":"USA","Origination_Fee":4.5,"Partner_Referral_Fee":2.25,"Address_Business":"5524 Eastbourne Dr","businessState":"USA","businessCity":"Anthill","business_PostalCode":"65488","business_name":"Test RSI","Owner_Address1":"5524 Eastbourne Dr","OwnerFirstName":"Test","OwnerLastName":"RSI","ownerCellPhone":"9456376565",    "Owner_First_Name":"test","Owner_Last_Name":"testlast","Owner_Address2":"testaddress","Owner_County":"USA","per_of_Ownership":2,"Purpose_of_Grant":"Payroll","Will_this_grant_create_new_jobs":"Yes","Number_of_Full_Time_Employees":2,"Number_of_Part_Time_Employees":3,"of_Jobs_Created":6,"of_Jobs_Retained":3,"Total_Score":4,"Business_Name":"t","Address2_Business":"t","ApplicationID":"DIR20000122","BusinessID":"","LeadID":"","OpportunityID":"'+objOppId+'","Stage":"SalesReview","AcceptCreditCard":"Yes","AnnualRevenue1":4,"ApplicationIDSBAPPP":"","Approved":"Yes","Are_you_COD_30_60_90":"xyztest","AverageMonthlyPayroll":4,"BriefHistoryonthebusiness":"abcdertqertest","BriefHistoryontheowner_manager":"qwertytest","BudgetConfirmed":true,"BusinessEIN":"wert","BusinessIDSBA_PPP":"","BusinessPhone":"pouyttest","BusinessStartDate":"2019-09-21","CampaignSource":"Alyssa Nagel","CAVIRSCOMPLETE":true,"City_Owner_1":"ree","CLEARCOMPLETE":true,"CloseDate":"2020-9-21","ClosingFee":5,"CommissionNotes":"poiuyttest","CorpDocReviewComplete":"Yes","CorpDoc_Notforexistingcustomers":true,"County":"USA","CreatedDate":"2019-09-21","CreditScore":5,"CurrSBAEconDisasterInjuryLoanBal":6,"CurrentDepartment":"Sales","DBA":"opotest","Decline_WithdrawnReason":"","DeclinedPicklist":"Sales","Description":"qwertyuiop","Disabled":"Yes","DiscoveryCompleted":false,"Do_50_per_of_empl_earn_less_than_51859":"Yes","DoYouCarryLifeInsurance":"asdfghjkkl","Do_you_have_a_tax_lien_of_taxes_due":"No","Do_you_pay_child_support_or_alimony":"ujkmnhgth","Do_you_rentown_business_space":"Yes","DOB":"2019-09-21","DOB_2":"2019-09-21","DOB_Owner_1":"2019-09-21","DOB_Owner_2":"2019-09-21","DOB_Owner_3":"2019-09-21","DOB_Owner_4":"2019-09-21","DOB_Owner_5":"2019-09-21","Does_the_Business_have_existing_SBA_Debt":"No","Due_to_Lendistry_Rep":3,"Due_to_Override_Manager":3,"Elevate_Dials":3,"Eligible_IA":"Yes","Email":"test@yopmail.com","Entity_Type":"Corporation","EPC":"qertwbxuw","EPC_EIN":"lkjhgds","Ethnicity":"Hispanic or Latino","ETRAN":true,"Exceptions":"NONE","Exhausted_Personal_NonSBA_Financing":"Yes","Existing_Customer":"Yes","Explanation_of_any_BKs_defaults_etc":"uiugevg","Fifth_Owner_Credit_Score":6,"Final_Lender":"Lendistry","Final_Loan_Amount":500000,"First_Day_of_Month":"2019-09-21","First_Name_2nd_Owner":"htuuhgyx","First_Owner_Credit_SCore":45,"Fiscal":"poiuy","ForecastCategory":"Omitted","ForecastCategoryName":"Omitted","Franchise":"Yes","Funded_Amount":200000,"Have_you_ever_been_convicted_of_a_crime":"No","Have_you_ever_defaulted_on_a_govt_loan":"No","Homeowner":"Yes","Interest_Rate":15,"Interest_Type":"Fixed","Is_the_US_Principal_place_of_residence":"Yes","IsSyncWithPortal":true,"won":true,"Last_Name_2nd_Owner":"testname","LastActivityDate":"2020-09-21","LeadSource":"Employee Referral","Legal_action_pending_against_youspouse":"Yes","Loan_Guaranty":"CalCap 7%","Loan_Type":"SBA","Loss_Reason":"Lost to Competitor","Majority_owner_US_CitizenLegal_Resident":"Yes","Monthly_Rent":200,"Monthly_Revenue":600,"NACIS_CODE_COMPLETE":true,"NAICS_CODE":"NAICSTEST","Name":"TestName","Net_Worth":300,"NextStep":"Testnext","Not_Interested":"Already Obtained Financing","Other":"TestOther","PACER_if_BK":true,"Packaging_Fee":300,"Phone":"8324565658","Photo_ID":true,"Planned_Changes_In_Next_6_Months":"qwertyuip","Payroll_Calculator_Complete":"Yes","Payroll_Calculator_Provided":true,"PPP_Note_Created":"Yes","Probability":100,"Processing_Fee":50,"Processing_Packaging_Fee":60,"Profitable_in_Last_2_Years":"Yes","Projected_Close_":"2019-09-21","Purpose_of_the_loan":"Payroll","Q1_2020_Payroll_Summary":true,"Race":"American Indian","Referral_Partner_Fee":300,"Referral_Partner_Payment_Sent":"2019-09-21","Referral_Source":"BANK","Requested_Amount":30000,"Requested_Funded":2000,"Revenue_less_than_1MM":"No","Review_Credit_Report_for_BK":true,"ROI_Analysis_Completed":true,"Run_Owner1_Credit_Report":true,"Run_Owner2_Credit_Report":true,"Run_Owner3_Credit_Report":true,"Run_Owner4_Credit_Report":true,"Run_Owner5_Credit_Report":true,"Rural":"No","Sales_Decline":"Credit","SBA_Application_Approval":"yestest","SBA_PPP_Loan_Application":true,"Street_Owner_1":"poiy","Projected_Close_Date":"2020-09-21","SBSS_SCORE":"Testsbss","Second_Owner_Credit_Score":85,"SOS":true,"SSN1":"poin","Stage_Start_Date":"2020-07-17","State_of_incopration":"NY","State_Owner_1":"NY","Status":"","Submit_loan_req_SBAfinancial_COVID19":"Yes","Tell_us_more":"Meat and Dairy","Term":5,"TIB_Months":"july","Time_at_Address":"cjsdcc","Total_Fees_Collected":500,"Total_Funds_to_Lendistry":5000000,"TotalOpportunityQuantity":10,"True_FICO":10,"Type":"Testtype","Use_of_Funds":"Working Capital","Veteran":"No","Website":"www.test.com","What_are_the_terms_of_your_current_lease":"nceibciwjbc","What_does_your_Business_do":"Manufacturer","What_exactly_does_the_business_do":"Carpenter","What_is_the_purpose_of_loan":"Homeloan","What_type_of_Business_is_it":"Printing","Who_is_your_customer_base":"Bghgvnh","Who_is_Your_Customer_Base1":"B2B","Will_this_Loan_create_more_Jobs":"Yes","Withdrawn_Picklist":"Sales","Women_Owned":"Yes","X019_Tax_Return_OR":true,"X0192020_Group_Health_Benefits_Paid":true,"X0192020_IRS_Form_940_IRS_Form_941":true,"X0192020_Retirement_Benefits_Paid":true,"X0KSB_Scholar_Alumni":"Yes","X2_Months_Payroll_Summary":true,"X18_Tax_Return_19_FYE_Financials":true,"X50_or_more_of_Employees_qualify_as_LMI":"YES - Employees make less than $50050","Zip_Code_Owner_1":"65488"}';
        RestContext.request = setTestRestRequest(requestBodyString,'/salesforce/SalesforceOpportuntyUpdateApi/*','POST');
        RestContext.response = new RestResponse();         
         Test.startTest();       
            SalesforceOpportuntyUpdateApi.UpdateOpportunity(); 
                     
        Test.stopTest();
    }
    
     Public static testmethod  void CreateOpportunity2(){          
       
        Opportunity objOpp = new Opportunity();
        objOpp.Stagename = 'New';
        objOpp.CloseDate= Date.today();
        objOpp.Name = 'Test';
        insert objOpp;
        Test.setMock(HttpCalloutMock.class, new JavaAPICallOut_Mock());       
        
        String requestBodyString = '{"Owner_First_Name":"test","Owner_Last_Name":"testlast","Owner_Address2":"testaddress","Owner_County":"USA","per_of_Ownership":2,"Purpose_of_Grant":"Payroll","Will_this_grant_create_new_jobs":"Yes","Number_of_Full_Time_Employees":2,"Number_of_Part_Time_Employees":3,"of_Jobs_Created":6,"of_Jobs_Retained":3,"Total_Score":4,"Business_Name":"t","Address2_Business":"t","ApplicationID":"DIR20000122","BusinessID":"","LeadID":"","OpportunityID":"000055","Stage":"SalesReview","AcceptCreditCard":"Yes","AnnualRevenue1":4,"ApplicationIDSBAPPP":"","Approved":"Yes","Are_you_COD_30_60_90":"xyztest","AverageMonthlyPayroll":4,"BriefHistoryonthebusiness":"abcdertqertest","BriefHistoryontheowner_manager":"qwertytest","BudgetConfirmed":true,"BusinessEIN":"wert","BusinessIDSBA_PPP":"","BusinessPhone":"pouyttest","BusinessStartDate":"2019-09-21","CampaignSource":"Alyssa Nagel","CAVIRSCOMPLETE":true,"City_Owner_1":"ree","CLEARCOMPLETE":true,"CloseDate":"2020-9-21","ClosingFee":5,"CommissionNotes":"poiuyttest","CorpDocReviewComplete":"Yes","CorpDoc_Notforexistingcustomers":true,"County":"USA","CreatedDate":"2019-09-21","CreditScore":5,"CurrSBAEconDisasterInjuryLoanBal":6,"CurrentDepartment":"Sales","DBA":"opotest","Decline_WithdrawnReason":"","DeclinedPicklist":"Sales","Description":"qwertyuiop","Disabled":"Yes","DiscoveryCompleted":false,"Do_50_per_of_empl_earn_less_than_51859":"Yes","DoYouCarryLifeInsurance":"asdfghjkkl","Do_you_have_a_tax_lien_of_taxes_due":"No","Do_you_pay_child_support_or_alimony":"ujkmnhgth","Do_you_rentown_business_space":"Yes","DOB":"2019-09-21","DOB_2":"2019-09-21","DOB_Owner_1":"2019-09-21","DOB_Owner_2":"2019-09-21","DOB_Owner_3":"2019-09-21","DOB_Owner_4":"2019-09-21","DOB_Owner_5":"2019-09-21","Does_the_Business_have_existing_SBA_Debt":"No","Due_to_Lendistry_Rep":3,"Due_to_Override_Manager":3,"Elevate_Dials":3,"Eligible_IA":"Yes","Email":"test@yopmail.com","Entity_Type":"Corporation","EPC":"qertwbxuw","EPC_EIN":"lkjhgds","Ethnicity":"Hispanic or Latino","ETRAN":true,"Exceptions":"NONE","Exhausted_Personal_NonSBA_Financing":"Yes","Existing_Customer":"Yes","Explanation_of_any_BKs_defaults_etc":"uiugevg","Fifth_Owner_Credit_Score":6,"Final_Lender":"Lendistry","Final_Loan_Amount":500000,"First_Day_of_Month":"2019-09-21","First_Name_2nd_Owner":"htuuhgyx","First_Owner_Credit_SCore":45,"Fiscal":"poiuy","ForecastCategory":"Omitted","ForecastCategoryName":"Omitted","Franchise":"Yes","Funded_Amount":200000,"Have_you_ever_been_convicted_of_a_crime":"No","Have_you_ever_defaulted_on_a_govt_loan":"No","Homeowner":"Yes","Interest_Rate":15,"Interest_Type":"Fixed","Is_the_US_Principal_place_of_residence":"Yes","IsSyncWithPortal":true,"won":true,"Last_Name_2nd_Owner":"testname","LastActivityDate":"2020-09-21","LeadSource":"Employee Referral","Legal_action_pending_against_youspouse":"Yes","Loan_Guaranty":"CalCap 7%","Loan_Type":"SBA","Loss_Reason":"Lost to Competitor","Majority_owner_US_CitizenLegal_Resident":"Yes","Monthly_Rent":200,"Monthly_Revenue":600,"NACIS_CODE_COMPLETE":true,"NAICS_CODE":"NAICSTEST","Name":"TestName","Net_Worth":300,"NextStep":"Testnext","Not_Interested":"Already Obtained Financing","Other":"TestOther","PACER_if_BK":true,"Packaging_Fee":300,"Phone":"8324565658","Photo_ID":true,"Planned_Changes_In_Next_6_Months":"qwertyuip","Payroll_Calculator_Complete":"Yes","Payroll_Calculator_Provided":true,"PPP_Note_Created":"Yes","Probability":100,"Processing_Fee":50,"Processing_Packaging_Fee":60,"Profitable_in_Last_2_Years":"Yes","Projected_Close_":"2019-09-21","Purpose_of_the_loan":"Payroll","Q1_2020_Payroll_Summary":true,"Race":"American Indian","Referral_Partner_Fee":300,"Referral_Partner_Payment_Sent":"2019-09-21","Referral_Source":"BANK","Requested_Amount":30000,"Requested_Funded":2000,"Revenue_less_than_1MM":"No","Review_Credit_Report_for_BK":true,"ROI_Analysis_Completed":true,"Run_Owner1_Credit_Report":true,"Run_Owner2_Credit_Report":true,"Run_Owner3_Credit_Report":true,"Run_Owner4_Credit_Report":true,"Run_Owner5_Credit_Report":true,"Rural":"No","Sales_Decline":"Credit","SBA_Application_Approval":"yestest","SBA_PPP_Loan_Application":true,"Street_Owner_1":"poiy","Projected_Close_Date":"2020-09-21","SBSS_SCORE":"Testsbss","Second_Owner_Credit_Score":85,"SOS":true,"SSN1":"poin","Stage_Start_Date":"2020-07-17","State_of_incopration":"NY","State_Owner_1":"NY","Status":"","Submit_loan_req_SBAfinancial_COVID19":"Yes","Tell_us_more":"Meat and Dairy","Term":5,"TIB_Months":"july","Time_at_Address":"cjsdcc","Total_Fees_Collected":500,"Total_Funds_to_Lendistry":5000000,"TotalOpportunityQuantity":10,"True_FICO":10,"Type":"Testtype","Use_of_Funds":"Working Capital","Veteran":"No","Website":"www.test.com","What_are_the_terms_of_your_current_lease":"nceibciwjbc","What_does_your_Business_do":"Manufacturer","What_exactly_does_the_business_do":"Carpenter","What_is_the_purpose_of_loan":"Homeloan","What_type_of_Business_is_it":"Printing","Who_is_your_customer_base":"Bghgvnh","Who_is_Your_Customer_Base1":"B2B","Will_this_Loan_create_more_Jobs":"Yes","Withdrawn_Picklist":"Sales","Women_Owned":"Yes","X019_Tax_Return_OR":true,"X0192020_Group_Health_Benefits_Paid":true,"X0192020_IRS_Form_940_IRS_Form_941":true,"X0192020_Retirement_Benefits_Paid":true,"X0KSB_Scholar_Alumni":"Yes","X2_Months_Payroll_Summary":true,"X18_Tax_Return_19_FYE_Financials":true,"X50_or_more_of_Employees_qualify_as_LMI":"YES - Employees make less than $50050","Zip_Code_Owner_1":"65488"}';
        RestContext.request = setTestRestRequest(requestBodyString,'/salesforce/SalesforceOpportuntyUpdateApi/*','POST');
        RestContext.response = new RestResponse();           
         Test.startTest();       
            SalesforceOpportuntyUpdateApi.UpdateOpportunity();  
                   
        Test.stopTest();
    }
    
    private static RestRequest setTestRestRequest(String requestBodyString, String url, String requestType) {
        RestRequest req = new RestRequest();
        req.requestURI = url; 
        req.httpMethod = requestType;
        req.requestBody = Blob.valueof(requestBodyString);
        return req;
        
    }
    private static RestResponse setTestRestResponse(String responseBodyString, String url, String responseType) {
        RestResponse res = new RestResponse();
        res.statusCode = 500;
        //res.responseURI = url; 
        //res.httpMethod = responseType;
        res.responseBody = Blob.valueof(responseBodyString);
        return res;
    }
}